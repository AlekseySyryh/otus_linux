# Сконфигурировать систему без отдельного раздела с /boot, а только с LVM

Репозиторий с пропатченым grub: https://yum.rumyantsev.com/centos/7/x86_64/

PV необходимо инициализировать с параметром --bootloaderareasize 1m

Предлагается действовать в два этапа.

Этап 1. Переносим существующий раздел boot в корневой раздел. Вместо раздела boot создаем новый PV в котором будет располагаться root раздел (к счастью он в этот раздел влезет)

Этап 2. Удаляем старые логические тома разделов root и swap и за их счет расширяем вновь созданный root.

2-й этап не содержит существенных особенностей, а вот в первом есть несколько нюансов, которые вызвали у меня сложности при выполнении задания.

1. Лучше сохранить содержимое старого раздела boot. initramfs и конфигурацию grub мы, конечно, потом перегенерируем заново, а вот ядро не поменяется и его лучше не трогать

2. Репозиторий не имеет GPG подписи, зато имеет просроченный сертификат SSL. Для борьбы с этими явлениеми в файл репозитория дописываем gpgcheck=0 и sslverify=0

3. Несмотря на то что /dev/sda вроде бы имеет установленный GRUB, его надо установить еще раз, чтобы заменить его на пропатченый (проблема на которой я потерял больше всего времени).

4. После переноса файлов в новый раздел надо создать в корне корневого раздела файл .autorelabel, иначе после перезагрузки selinux откажется нас пускать в систему.

Остальные пункты так-же следуют из предыдущих заданий и вопросов не вызывают.

Воспроизведение

    scriptreplay -ttiming -sscript -m.5


